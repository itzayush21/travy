<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>TravelPods Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Orbitron:wght@500&display=swap"
    rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r121/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.net.min.js"></script>

  <style>
    /* Reset & Base */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #ffffff;
      background: url('{{ url_for("static", filename="/img/pic1.png") }}') no-repeat center center fixed;
      background-size: cover;
      position: relative;
      min-height: 100vh;
      overflow-x: hidden;
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      z-index: -2;
      background: rgba(0, 0, 0, 0.7);
    }

    body::after {
      content: "";
      position: fixed;
      inset: 0;
      z-index: -1;
      background: #0f0c29;
      mix-blend-mode: screen;
    }

    #vanta-bg {
      position: fixed;
      width: 100%;
      height: 100%;
      z-index: -3;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    ul {
      list-style: none;
    }

    .navbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.2rem 2rem;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(10px);
      position: sticky;
      top: 0;
      z-index: 10;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
    }

    .logo {
      font-size: 1.8rem;
      font-weight: bold;
      background: linear-gradient(to right, #b499ff, #e7c8ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .nav-links {
      display: flex;
      gap: 1.5rem;
    }

    .nav-links li a {
      font-weight: 500;
      transition: color 0.3s;
    }

    .nav-links li a:hover {
      color: #b499ff;
    }

    .dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 1.5rem;
      padding: 2rem;
      z-index: 1;
    }

    .card {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      padding: 1.5rem;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(15px);
      transition: transform 0.4s ease, box-shadow 0.4s ease;
      animation: fadeInUp 0.7s ease forwards;
      opacity: 0;
      transform: translateY(30px);
      animation-delay: calc(var(--i) * 0.1s);
    }

    @keyframes fadeInUp {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .card:hover {
      transform: translateY(-5px) scale(1.01);
      box-shadow: 0 10px 40px rgba(180, 153, 255, 0.3);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.8rem;
    }

    .card.ai-model,
    .card.itinerary,
    .card.packing,
    .card.budget,
    .card.ai-chat,
    .card.ai-chat2,
    .card.details {
      grid-column: span 2;
      min-height: 320px;
    }

    .card-row.dash-row {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      /* 3 equal columns */
      gap: 1.5rem;
      grid-column: 1 / -1;
      /* Span the entire grid width */
    }

    .card-row .card {
      min-height: 320px;
    }

    .dash-placeholder {
      height: 250px;
      background: rgba(255, 255, 255, 0.04);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #b499ff;
      font-weight: 600;
      font-size: 1rem;
      border: 1px dashed #c083ff;
    }

    .card.members-info {
      grid-column: span 2;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 2rem;
    }

    .card.members-info>div {
      flex: 1;
    }

    .status {
      padding: 0.3rem 0.6rem;
      border-radius: 12px;
      font-size: 0.75rem;
      text-transform: uppercase;
      font-weight: bold;
    }

    .status.live {
      background-color: #3effc4;
      color: #0f0;
    }

    .status.upcoming {
      background-color: #ff9d00;
      color: #fff;
    }

    .edit-btn {
      background: #b499ff;
      color: #000;
      border: none;
      border-radius: 8px;
      padding: 0.3rem 0.8rem;
      font-size: 0.85rem;
      cursor: pointer;
      transition: background 0.3s;
    }

    .edit-btn.small {
      font-size: 0.75rem;
      padding: 0.2rem 0.6rem;
    }

    .edit-btn:hover {
      background: #e2c8ff;
    }

    .avatars {
      display: flex;
      align-items: center;
      gap: 0.6rem;
    }

    .avatars img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 2px solid #b499ff;
    }

    .add-more {
      font-size: 0.9rem;
      background: #b499ff;
      color: #000;
      padding: 0.3rem 0.6rem;
      border-radius: 20px;
      font-weight: bold;
    }

    .chatbox,
    .chatbox2 {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    .chatbox input,
    .chatbox2 input {
      flex: 1;
      padding: 0.5rem 1rem;
      border-radius: 12px;
      border: 1px solid #b499ff;
      background: rgba(255, 255, 255, 0.05);
      color: #fff;
    }

    .chatbox button .chatbox2 button {
      background: #b499ff;
      border: none;
      padding: 0.5rem;
      border-radius: 50%;
      cursor: pointer;
    }

    .chatbox button img .chatbox2 button img {
      width: 20px;
      height: 20px;
    }

    .big {
      font-size: 2.2rem;
      font-weight: bold;
      color: #b499ff;
    }

    @media (max-width: 768px) {
      .navbar {
        flex-direction: column;
        align-items: flex-start;
      }

      .nav-links {
        flex-direction: column;
        gap: 0.5rem;
        margin-top: 0.8rem;
      }
    }

    footer {
      margin-top: 3rem;
      padding: 2rem;
      background: linear-gradient(to right, #684bea, #928dab);
      text-align: center;
      color: #fff;
      border-top: 2px solid rgba(255, 255, 255, 0.1);
    }

    footer p {
      margin-bottom: 0.5rem;
      font-size: 0.95rem;
    }

    footer .socials {
      margin-top: 0.8rem;
      display: flex;
      justify-content: center;
      gap: 1rem;
    }

    footer .socials a {
      color: #ffffff;
      font-size: 1.2rem;
      transition: color 0.3s ease;
    }

    footer .socials a:hover {
      color: #b499ff;
    }

    .hero {
      grid-column: 1 / -1;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-size: cover;
      border-radius: 20px;
      margin-bottom: 2rem;
      padding: 3rem 2rem;
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
      animation: fadeInHero 1s ease-out forwards;
      opacity: 0;
      backdrop-filter: blur(4px);
      overflow: hidden;
    }

    .hero-content {
      flex: 1;
      padding-right: 2rem;
    }

    .hero-content h1 {
      font-size: 3rem;
      color: #ffffff;
      margin-bottom: 1rem;
      font-family: 'Orbitron', sans-serif;
    }

    .hero-content .tagline {
      font-size: 1.3rem;
      color: #eaeaea;
      margin-bottom: 0.5rem;
    }

    .hero-content .date-range {
      font-size: 1.1rem;
      color: #ccc;
    }

    .hero .status {
      margin-top: 1rem;
      display: inline-block;
      padding: 0.4rem 1rem;
      border-radius: 20px;
      font-weight: bold;
      font-size: 0.9rem;
      background: #b499ff;
      color: #000;
      box-shadow: 0 0 10px rgba(180, 153, 255, 0.4);
    }

    .hero-image {
      flex: 1;
      max-width: 400px;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
      transition: transform 0.3s ease;
    }

    .hero-image img {
      width: 100%;
      height: auto;
      display: block;
      border-radius: inherit;
    }

    .hero:hover .hero-image {
      transform: scale(1.03);
    }

    @keyframes fadeInHero {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @media (max-width: 900px) {
      .hero {
        flex-direction: column;
        text-align: center;
        padding: 2rem;
      }

      .hero-content {
        padding-right: 0;
      }

      .hero-image {
        margin-top: 1.5rem;
        max-width: 90%;
      }
    }

    .chat-output,
    .chat-output2 {
      max-height: 300px;
      /* or any height you want */
      overflow-y: auto;
      padding: 10px;
      margin-top: 10px;
      border: 1px solid #ccc;
      background-color: #381e54;
      border-radius: 8px;
      font-size: 0.95rem;
    }

    #note-form textarea {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      resize: vertical;
    }

    #note-form button {
      margin-top: 5px;
      background-color: #1976d2;
      color: white;
      border: none;
      padding: 6px 12px;
      cursor: pointer;
    }

    .note-entry {
      margin-top: 8px;
      padding: 6px;
      border-bottom: 1px solid #ddd;
    }

    /* Make note display scrollable */
    #note-list {
      max-height: 200px;
      /* Adjust as needed */
      overflow-y: auto;
      margin-top: 10px;
    }
  </style>


</head>

<div id="vanta-bg"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r121/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.net.min.js"></script>
<script>
  VANTA.NET({
    el: "#vanta-bg",
    mouseControls: true,
    touchControls: true,
    gyroControls: false,
    minHeight: 200.00,
    minWidth: 200.00,
    scale: 1.0,
    scaleMobile: 1.0,
    color: 0xb499ff,
    backgroundColor: 0x0f0c29,
    points: 10.00,
    maxDistance: 20.00
  });
</script>

<body>
  <nav class="navbar">
    <div class="logo">üåå TravelPods</div>
    <ul class="nav-links">
      <li><a href="/dashboard">Dashboard</a></li>
      <li><a href="#">Your Pods</a></li>
      <li><a href="/logout">Logout</a></li>
    </ul>
  </nav>

  <section class="hero">
    <div class="hero-content">
      <h1>{{ pod.name }}</h1>
      <p class="tagline">Destination: <strong>{{ pod.destination }}</strong></p>
      <p class="tagline">Trip Type: <strong>{{ pod.invite_code }}</strong></p>
      <p class="date-range">üìÖ {{ pod.start_date.strftime('%d %b') }} ‚Äì {{ pod.end_date.strftime('%d %b') }}</p>
      <span class="status {{ 'live' if pod.status == 'active' else 'upcoming' }}">{{ pod.status.capitalize() }}</span>
    </div>
  </section>



  <main class="dashboard">

    <section class="card details" style="--i:1">
      <div class="card-header">
        <h2>Trip Other Details</h2>
        <button class="edit-btn small">Edit</button>
      </div>
      <ul style="list-style: none; padding: 0; margin: 0;">
        <li style="margin-bottom: 8px;"><strong style="color: #22cee1;">Description:</strong> {{ pod.description }}</li>
        <li style="margin-bottom: 8px;"><strong style="color: #22cee1;">Created By:</strong> {% for member in members
          %}{%
          if member.id == pod.created_by %}{{ member.name }}{% endif %}{% endfor %}</li>
        <li style="margin-bottom: 8px;"><strong style="color: #22cee1;">Created At:</strong> {{
          pod.created_at.strftime('%d
          %b %Y') }}</li>
        <li style="margin-bottom: 8px;"><strong style="color: #22cee1;">Estimated Budget:</strong> ‚Çπ{{
          pod.estimated_budget
          }}</li>
        <li style="margin-bottom: 8px;"><strong style="color: #22cee1;">Invite Code:</strong> {{ pod.invite_code }}</li>
      </ul>
    </section>

    <section class="card" style="--i:2; padding: 16px;">
      <h2 style="margin-bottom: 12px;">Members</h2>
      <div class="avatars" style="display: flex; flex-direction: column; gap: 10px;">

        {% for member in members[:3] %}
        <div style="display: flex; align-items: center; gap: 10px;">
          <a href="{{ url_for('view_profile', user_id=member.id) }}" title="{{ member.name }}"
            style="display: inline-block;">
            <img src="{{ url_for('static', filename='img/avatar' ~ loop.index ~ '.png') }}" alt="{{ member.name }}"
              style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">
          </a>
          <span style="font-size: 16px; color: #e0e0e0;">{{ member.name }}</span>
        </div>
        {% endfor %}

        {% if extra_count > 0 %}
        <div class="add-more" style="margin-top: 10px; font-size: 15px; color: #666;">+{{ extra_count }} more</div>
        {% endif %}

      </div>
    </section>



    <section class="card weather" style="--i:3">
      <div class="card-header">
        <h2>Current Weather</h2>
        <span class="status live">Live</span>
      </div>
      <div style="margin-top: 1rem;">
        <p style="font-size: 1.6rem;">üå§Ô∏è 32¬∞C ‚Äì Sunny</p>
        <p>Humidity: 60%</p>
        <p>Wind: 15 km/h</p>
        <p>Location: {{ pod.destination }}</p>
      </div>
    </section>

    <section class="card itinerary" style="--i:3">
      <div class="card-header">
        <h2>Itinerary</h2>
        <div style="display: flex; gap: 0.5rem;">
          <form method="POST" action="/pod/{{ pod.id }}/itinerary/create">
            <button type="submit" class="edit-btn small">Create with AI</button>
          </form>
          <button class="edit-btn small" onclick="toggleEdit()">Edit</button>
        </div>
      </div>

      <!-- Static View -->
      <div id="itinerary-view"
        style="white-space: pre-wrap; max-height: 400px; overflow-y: auto; padding: 1rem; background: rgba(255,255,255,0.03); border-radius: 10px; font-family: 'Inter', sans-serif;">
        {{ itinerary.description | safe if itinerary else "üìù No itinerary yet." }}
      </div>

      <!-- Editable Form -->
      <form method="POST" action="/pod/{{ pod.id }}/itinerary/edit">
        <textarea id="itinerary-edit" name="content"
          style="display: none; width: 100%; height: 300px; background: rgba(255,255,255,0.06); border: none; color: #fff; padding: 1rem; border-radius: 12px;">{{ itinerary.description if itinerary else "" }}</textarea>
        <button id="save-btn" class="edit-btn" style="margin-top: 0.8rem; display: none;" type="submit">Save</button>
      </form>

      <form method="POST" action="/pod/{{ pod.id }}/itinerary/ai-edit" style="margin-top: 0.5rem;">
        <input type="text" name="edit_prompt" placeholder="e.g., Add 2 days for rest and shopping" required
          style="width: 100%;padding: 4px 8px; border-radius: 8px;" />
        <button type="submit" class="edit-btn small">Refine with AI</button>
      </form>
    </section>


    <section class="card itinerary" style="--i:4">
      <div class="card-header">
        <h2>Packing List</h2>
        <div style="display: flex; gap: 0.5rem;">
          <form method="POST" action="/pod/{{ pod.id }}/packing/create">
            <button type="submit" class="edit-btn small">Create with AI</button>
          </form>
          <button class="edit-btn small" onclick="togglePackingEdit()">Edit</button>
        </div>
      </div>

      <!-- Static View -->
      <div id="packing-view" style="white-space: pre-wrap; max-height: 400px; overflow-y: auto;">
        {{ packing.description | safe if packing else "üß≥ No packing list yet." }}
      </div>

      <!-- Edit View -->
      <form id="packing-edit-form" method="POST" action="/pod/{{ pod.id }}/packing/manual"
        style="display:none; margin-top: 0.8rem;">
        <textarea name="description" rows="6"
          style="width: 100%; border-radius: 10px; padding: 8px;">{{ packing.description if packing else '' }}</textarea>
        <button type="submit" class="edit-btn small" style="margin-top: 0.5rem;">Save</button>
      </form>

      <!-- AI Update Prompt -->
      <form method="POST" action="/pod/{{ pod.id }}/packing/ai-edit" style="margin-top: 0.5rem;">
        <input type="text" name="edit_prompt" placeholder="e.g., Add winter gear" required
          style="width: 100%;padding: 4px 8px; border-radius: 8px;" />
        <button type="submit" class="edit-btn small">Refine with AI</button>
      </form>
    </section>

    <script>
      function togglePackingEdit() {
        const view = document.getElementById("packing-view");
        const form = document.getElementById("packing-edit-form");
        view.style.display = view.style.display === 'none' ? 'block' : 'none';
        form.style.display = form.style.display === 'none' ? 'block' : 'none';
      }
    </script>


    <section class="card budget" style="--i:5">
      <div class="card-header">
        <h2>Budget & Expenses</h2><button class="edit-btn small">Add</button>
      </div>
      <p>Total ‚Çπ38,500 ‚Ä¢ Your ‚Çπ9,625</p>
      <div class="expense-bar">
        <div class="filled" style="width: 70%;"></div>
      </div>
    </section>

    <section class="card budget" style="--i:4">
      <div class="card-header">
        <h2>Budget Planning</h2>
        <div style="display: flex; gap: 0.5rem;">
          <form method="POST" action="/pod/{{ pod.id }}/budget/create">
            <button type="submit" class="edit-btn small">Generate with AI</button>
          </form>
          <button class="edit-btn small" onclick="toggleBudgetEdit()">Edit</button>
        </div>
      </div>

      {% if budget %}
      <div id="budget-view" style="white-space: pre-wrap; max-height: 240px; overflow-y: auto;">
        {{ budget.description|safe }}
      </div>
      {% else %}
      <p>No budget plan yet.</p>
      {% endif %}

      <!-- Manual Edit -->
      <form id="budget-edit-form" method="POST" action="/pod/{{ pod.id }}/budget/edit"
        style="display: none; margin-top: 1rem;">
        <textarea name="description" rows="6" placeholder="Edit your budget details..."
          style="width: 100%; padding: 8px; border-radius: 8px;"></textarea>
        <button type="submit" class="edit-btn small" style="margin-top: 0.5rem;">Save</button>
      </form>

      <!-- AI Refinement Prompt -->
      <form method="POST" action="/pod/{{ pod.id }}/budget/ai-edit" style="margin-top: 0.5rem;">
        <input type="text" name="edit_prompt" placeholder="e.g., Add ‚Çπ3000 for shopping" required
          style="width: 100%; padding: 4px 8px; border-radius: 8px;" />
        <button type="submit" class="edit-btn small">Refine with AI</button>
      </form>
    </section>

    <script>
      function toggleBudgetEdit() {
        const form = document.getElementById('budget-edit-form');
        form.style.display = form.style.display === 'none' ? 'block' : 'none';
      }
    </script>


    <section class="card" style="--i:6">
      <div class="card-header">
        <h2>Pod Notes</h2>
        <button class="edit-btn small" onclick="document.getElementById('note-form').style.display='block'">Add</button>
      </div>

      <div id="note-list">
        {% for note in notes %}
          <div class="note-entry">
            <p>
              <strong>
                {% for member in members %}
                  {% if member.id == note.user_id %}
                    {{ member.name }}
                  {% endif %}
                {% endfor %}
              </strong><br>
              <small>{{ note.created_at.strftime('%d %b %Y') }}</small>
            </p>
            <div style="border-left: 2px solid #b499ff; margin: 8px 0; padding-left: 10px;">
              {{ note.note }}
            </div>
            <form method="POST" action="/pod/{{ pod.id }}/notes/delete/{{ note.id }}" style="display:inline;">
              <button type="submit" class="edit-btn small" style="background: #ff4d4d; color: #fff;">Delete</button>
            </form>
          {% endfor %}

        </div>

        <div id="note-form" style="display:none;">
          <textarea id="note-text" placeholder="Write a note..."></textarea>
          <button onclick="submitNote()">Submit</button>
        </div>
    </section>



    <section class="card ai-chat" style="--i:8">
      <h2>Destination Research Assistant</h2>
      <div class="chatbox">
        <input placeholder="Ask me anything..." />
        <button><img src="{{ url_for('static', filename='img/ai-icon.png') }}"></button>
      </div>
      <div class="chat-output" id="chat-output"></div> <!-- Scrollable area -->
    </section>

    <section class="card" style="--i:9">
      <h2>Countdown</h2>
      <p class="big">3 Days Left</p>
      <p>Phase: <span class="status upcoming">Pre‚ÄëTrip</span></p>
    </section>

    <section class="card" style="--i:10">
      <h2>Notifications</h2>
      <ul>
        <li>Weather today: ‚òÄÔ∏è Sunny</li>
        <li>Pack sunscreen</li>
      </ul>
    </section>

    <section class="card ai-chat2" style="--i:8">
      <h2>Destination Research Assistant</h2>
      <div class="chatbox2">
        <input placeholder="Ask me anything..." />
        <button><img src="{{ url_for('static', filename='img/ai-icon.png') }}"></button>
      </div>
      <div class="chat-output2" id="chat-output2"></div> <!-- Scrollable area -->
    </section>

    <section class="card" style="--i:11">
      <h2>Trip Summary</h2><button class="edit-btn">Generate with AI</button>
    </section>

    <div style="grid-column: 1 / -1;">
      <h2 style="margin: 1rem 0; font-size: 2rem; color: #b499ff; text-align: center;">üìä Travel Analysis</h2>
    </div>

    <section class="card-row dash-row" style="--i:13">
      <div class="card">
        <div class="card-header">
          <h2>Travel Insights</h2>
          <span class="status live">Visual</span>
        </div>
        <p>Summary of travel stats and group trends.</p>
        <div class="dash-placeholder">Graphical Dashboard Placeholder 1</div>
      </div>

      <div class="card">
        <div class="card-header">
          <h2>Expense Analytics</h2>
          <span class="status live">Visual</span>
        </div>
        <p>Breakdown of cost categories and sharing patterns.</p>
        <div class="dash-placeholder">Graphical Dashboard Placeholder 2</div>
      </div>

      <div class="card">
        <div class="card-header">
          <h2>AI Predictions</h2>
          <span class="status live">Forecast</span>
        </div>
        <p>Predicted satisfaction, weather, or booking load based on current plans.</p>
        <div class="dash-placeholder">AI-Powered Dashboard Placeholder</div>
      </div>
    </section>
  </main>

  <footer>
    <p>üåç TravelPods &copy; 2025 ‚Äî All Rights Reserved</p>
    <p>Plan smart. Travel smarter. ‚úàÔ∏è</p>
    <div class="socials">
      <a href="#"><i class="fa fa-twitter"></i></a>
      <a href="#"><i class="fa fa-instagram"></i></a>
      <a href="#"><i class="fa fa-github"></i></a>
    </div>
  </footer>

  

  <script>
    function toggleEdit() {
      const view = document.getElementById('itinerary-view');
      const edit = document.getElementById('itinerary-edit');
      const saveBtn = document.getElementById('save-btn');

      if (edit.style.display === 'none') {
        view.style.display = 'none';
        edit.style.display = 'block';
        saveBtn.style.display = 'inline-block';
      } else {
        view.style.display = 'block';
        edit.style.display = 'none';
        saveBtn.style.display = 'none';
      }
    }

    const podId = "{{ pod.id }}";
    document.querySelector('.chatbox2 button').addEventListener('click', async () => {
      const input = document.querySelector('.chatbox2 input');
      const message = input.value.trim();
      if (!message) return;

      const chatSection = document.querySelector('#chat-output2'); // Scrollable container
      const responseDiv = document.createElement('div');
      responseDiv.innerHTML = `<p><b>You:</b> ${message}</p><p><i>Loading...</i></p>`;
      chatSection.appendChild(responseDiv);
      chatSection.scrollTop = chatSection.scrollHeight; // Scroll to bottom

      const res = await fetch(`/pod/${podId}/ask`, {
        method: "POST",
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message })
      });
      const data = await res.json();

      responseDiv.innerHTML = `<p><b>You:</b> ${message}</p><p><b>Assistant:</b> ${data.response}</p>`;
      input.value = "";
      chatSection.scrollTop = chatSection.scrollHeight;
    });


    document.querySelector('.chatbox button').addEventListener('click', async () => {
      const input = document.querySelector('.chatbox input');
      const message = input.value.trim();
      if (!message) return;

      const chatSection = document.querySelector('#chat-output'); // Scrollable container
      const responseDiv = document.createElement('div');
      responseDiv.innerHTML = `<p><b>You:</b> ${message}</p><p><i>Loading...</i></p>`;
      chatSection.appendChild(responseDiv);
      chatSection.scrollTop = chatSection.scrollHeight; // Scroll to bottom

      const res = await fetch(`/pod/${podId}/help`, {
        method: "POST",
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message })
      });
      const data = await res.json();

      responseDiv.innerHTML = `<p><b>You:</b> ${message}</p><p><b>Assistant:</b> ${data.response}</p>`;
      input.value = "";
      chatSection.scrollTop = chatSection.scrollHeight;
    });




    const userId = "{{ user_id }}";


    async function submitNote() {
      const text = document.getElementById('note-text').value.trim();
      if (!text) return;

      const res = await fetch(`/pods/${podId}/notes`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ user_id: userId, note: text })
      });

      if (res.ok) {
        const data = await res.json();
        appendNote(userName, text, data.created_at);
        document.getElementById('note-text').value = '';
        document.getElementById('note-form').style.display = 'none';
      }
    }


  </script>


  </script>

</body>

</html>